<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ParentPlan - ペアレンティングプラン作成支援プラットフォーム</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .sidebar-active { transform: translateX(0); }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .step-active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .step-completed { background: #10b981; color: white; }
        .calendar-day { transition: all 0.2s; }
        .calendar-day:hover { background: #f3f4f6; }
        .calendar-selected { background: #3b82f6; color: white; }
        .message-bubble { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body class="bg-gray-50">
    <!-- ヘッダー -->
    <header class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center">
                    <i class="fas fa-family text-blue-600 text-2xl mr-3"></i>
                    <h1 class="text-xl font-bold text-gray-900">ParentPlan</h1>
                </div>
                <nav class="hidden md:flex space-x-8">
                    <a href="#" onclick="showSection('dashboard')" class="text-gray-700 hover:text-blue-600 font-medium">ダッシュボード</a>
                    <a href="#" onclick="showSection('wizard')" class="text-gray-700 hover:text-blue-600 font-medium">プラン作成</a>
                    <a href="#" onclick="showSection('calendar')" class="text-gray-700 hover:text-blue-600 font-medium">カレンダー</a>
                    <a href="#" onclick="showSection('communication')" class="text-gray-700 hover:text-blue-600 font-medium">コミュニケーション</a>
                    <a href="#" onclick="showSection('expenses')" class="text-gray-700 hover:text-blue-600 font-medium">費用管理</a>
                </nav>
                <div class="flex items-center space-x-4">
                    <button class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-bell"></i>
                    </button>
                    <div class="h-8 w-8 bg-blue-600 rounded-full flex items-center justify-center">
                        <span class="text-white text-sm font-medium">田</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- メインコンテンツ -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        
        <!-- ダッシュボード -->
        <div id="dashboard" class="section">
            <div class="mb-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-2">ダッシュボード</h2>
                <p class="text-gray-600">お子様のための最適なペアレンティングプランを作成・管理しましょう</p>
            </div>

            <!-- 統計カード -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-lg shadow-sm p-6 border">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-blue-100">
                            <i class="fas fa-calendar-alt text-blue-600"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">今月の面会日数</p>
                            <p class="text-2xl font-semibold text-gray-900">12日</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-sm p-6 border">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-green-100">
                            <i class="fas fa-yen-sign text-green-600"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">今月の養育費</p>
                            <p class="text-2xl font-semibold text-gray-900">¥85,000</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-sm p-6 border">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-purple-100">
                            <i class="fas fa-comments text-purple-600"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">未読メッセージ</p>
                            <p class="text-2xl font-semibold text-gray-900">3件</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-sm p-6 border">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-orange-100">
                            <i class="fas fa-tasks text-orange-600"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">プラン進捗</p>
                            <p class="text-2xl font-semibold text-gray-900">80%</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 最近のアクティビティ -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white rounded-lg shadow-sm border">
                    <div class="p-6 border-b">
                        <h3 class="text-lg font-semibold text-gray-900">最近のアクティビティ</h3>
                    </div>
                    <div class="p-6">
                        <div class="space-y-4">
                            <div class="flex items-start">
                                <div class="p-2 bg-blue-100 rounded-full mr-3">
                                    <i class="fas fa-calendar-plus text-blue-600 text-sm"></i>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-900">面会スケジュールが追加されました</p>
                                    <p class="text-xs text-gray-500">2時間前</p>
                                </div>
                            </div>
                            <div class="flex items-start">
                                <div class="p-2 bg-green-100 rounded-full mr-3">
                                    <i class="fas fa-check text-green-600 text-sm"></i>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-900">養育費の支払いが完了しました</p>
                                    <p class="text-xs text-gray-500">1日前</p>
                                </div>
                            </div>
                            <div class="flex items-start">
                                <div class="p-2 bg-purple-100 rounded-full mr-3">
                                    <i class="fas fa-message text-purple-600 text-sm"></i>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-900">新しいメッセージが届きました</p>
                                    <p class="text-xs text-gray-500">2日前</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 養育時間の分布 -->
                <div class="bg-white rounded-lg shadow-sm border">
                    <div class="p-6 border-b">
                        <h3 class="text-lg font-semibold text-gray-900">養育時間の分布</h3>
                    </div>
                    <div class="p-6">
                        <canvas id="parentingTimeChart" style="height: 300px;"></canvas>
                    </div>
                </div>
            </div>

            <!-- クイックアクション -->
            <div class="mt-8">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">クイックアクション</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <button onclick="showSection('wizard')" class="bg-blue-600 hover:bg-blue-700 text-white p-6 rounded-lg text-left">
                        <i class="fas fa-plus-circle text-2xl mb-2"></i>
                        <h4 class="font-semibold">新しいプラン作成</h4>
                        <p class="text-sm opacity-90">ペアレンティングプランを新規作成</p>
                    </button>
                    <button onclick="showSection('calendar')" class="bg-green-600 hover:bg-green-700 text-white p-6 rounded-lg text-left">
                        <i class="fas fa-calendar-plus text-2xl mb-2"></i>
                        <h4 class="font-semibold">スケジュール追加</h4>
                        <p class="text-sm opacity-90">面会や行事の予定を追加</p>
                    </button>
                    <button onclick="showSection('communication')" class="bg-purple-600 hover:bg-purple-700 text-white p-6 rounded-lg text-left">
                        <i class="fas fa-comments text-2xl mb-2"></i>
                        <h4 class="font-semibold">メッセージ送信</h4>
                        <p class="text-sm opacity-90">相手方とのコミュニケーション</p>
                    </button>
                </div>
            </div>
        </div>

        <!-- プラン作成ウィザード -->
        <div id="wizard" class="section hidden">
            <div class="mb-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-2">ペアレンティングプラン作成</h2>
                <p class="text-gray-600">ステップに従って、お子様に最適なペアレンティングプランを作成しましょう</p>
            </div>

            <!-- プログレスバー -->
            <div class="mb-8">
                <div class="flex items-center justify-between mb-4">
                    <div class="step-circle step-active" data-step="1">
                        <i class="fas fa-user-friends"></i>
                        <span>基本情報</span>
                    </div>
                    <div class="step-circle" data-step="2">
                        <i class="fas fa-gavel"></i>
                        <span>親権設定</span>
                    </div>
                    <div class="step-circle" data-step="3">
                        <i class="fas fa-calendar-alt"></i>
                        <span>スケジュール</span>
                    </div>
                    <div class="step-circle" data-step="4">
                        <i class="fas fa-yen-sign"></i>
                        <span>財務設定</span>
                    </div>
                    <div class="step-circle" data-step="5">
                        <i class="fas fa-file-contract"></i>
                        <span>確認・完了</span>
                    </div>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 20%" id="progressBar"></div>
                </div>
            </div>

            <!-- ステップ1: 基本情報 -->
            <div id="step1" class="wizard-step">
                <div class="bg-white rounded-lg shadow-sm border p-8">
                    <h3 class="text-xl font-semibold text-gray-900 mb-6">基本情報の入力</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <!-- 親1の情報 -->
                        <div>
                            <h4 class="text-lg font-medium text-gray-900 mb-4">親1の情報</h4>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">氏名</label>
                                    <input type="text" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500" placeholder="田中 太郎">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">住所</label>
                                    <input type="text" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500" placeholder="東京都渋谷区...">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">電話番号</label>
                                    <input type="tel" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500" placeholder="090-1234-5678">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">メールアドレス</label>
                                    <input type="email" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500" placeholder="taro@example.com">
                                </div>
                            </div>
                        </div>

                        <!-- 親2の情報 -->
                        <div>
                            <h4 class="text-lg font-medium text-gray-900 mb-4">親2の情報</h4>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">氏名</label>
                                    <input type="text" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500" placeholder="田中 花子">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">住所</label>
                                    <input type="text" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500" placeholder="神奈川県横浜市...">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">電話番号</label>
                                    <input type="tel" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500" placeholder="080-9876-5432">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">メールアドレス</label>
                                    <input type="email" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500" placeholder="hanako@example.com">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 子供の情報 -->
                    <div class="mt-8">
                        <h4 class="text-lg font-medium text-gray-900 mb-4">お子様の情報</h4>
                        <div id="childrenList">
                            <div class="border border-gray-200 rounded-lg p-4 mb-4">
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">氏名</label>
                                        <input type="text" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500" placeholder="田中 一郎">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">生年月日</label>
                                        <input type="date" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">現在の主な居住地</label>
                                        <select class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500">
                                            <option>親1宅</option>
                                            <option>親2宅</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button onclick="addChild()" class="text-blue-600 hover:text-blue-800 font-medium">
                            <i class="fas fa-plus mr-2"></i>お子様を追加
                        </button>
                    </div>

                    <div class="flex justify-end mt-8">
                        <button onclick="nextStep()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium">
                            次へ <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- ステップ2: 親権設定 -->
            <div id="step2" class="wizard-step hidden">
                <div class="bg-white rounded-lg shadow-sm border p-8">
                    <h3 class="text-xl font-semibold text-gray-900 mb-6">親権・監護権の設定</h3>
                    
                    <div class="space-y-8">
                        <!-- 法的親権 -->
                        <div>
                            <h4 class="text-lg font-medium text-gray-900 mb-4">法的親権</h4>
                            <div class="space-y-3">
                                <label class="flex items-center">
                                    <input type="radio" name="legalCustody" value="joint" class="mr-3">
                                    <div>
                                        <span class="font-medium">共同親権</span>
                                        <p class="text-sm text-gray-600">両親が重要な決定を共同で行います</p>
                                    </div>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="legalCustody" value="sole1" class="mr-3">
                                    <div>
                                        <span class="font-medium">親1の単独親権</span>
                                        <p class="text-sm text-gray-600">親1が全ての法的決定を行います</p>
                                    </div>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="legalCustody" value="sole2" class="mr-3">
                                    <div>
                                        <span class="font-medium">親2の単独親権</span>
                                        <p class="text-sm text-gray-600">親2が全ての法的決定を行います</p>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- 物理的監護権 -->
                        <div>
                            <h4 class="text-lg font-medium text-gray-900 mb-4">物理的監護権</h4>
                            <div class="space-y-3">
                                <label class="flex items-center">
                                    <input type="radio" name="physicalCustody" value="joint" class="mr-3">
                                    <div>
                                        <span class="font-medium">共同監護</span>
                                        <p class="text-sm text-gray-600">子どもが両親の家で相当な時間を過ごします</p>
                                    </div>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="physicalCustody" value="primary1" class="mr-3">
                                    <div>
                                        <span class="font-medium">親1が主たる監護者</span>
                                        <p class="text-sm text-gray-600">子どもは主に親1と居住し、親2に面会権</p>
                                    </div>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="physicalCustody" value="primary2" class="mr-3">
                                    <div>
                                        <span class="font-medium">親2が主たる監護者</span>
                                        <p class="text-sm text-gray-600">子どもは主に親2と居住し、親1に面会権</p>
                                    </div>
                                </label>
                            </div>
                        </div>
                        
                        <!-- 重要な決定事項 -->
                        <div>
                            <h4 class="text-lg font-medium text-gray-900 mb-4">重要な決定事項の権限分担</h4>
                            <div class="space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-center">
                                    <span class="font-medium text-gray-700">医療・健康管理</span>
                                    <label class="flex items-center"><input type="radio" name="medical" value="joint" class="mr-2">共同</label>
                                    <label class="flex items-center"><input type="radio" name="medical" value="parent1" class="mr-2">親1</label>
                                    <label class="flex items-center"><input type="radio" name="medical" value="parent2" class="mr-2">親2</label>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-center">
                                    <span class="font-medium text-gray-700">教育関連</span>
                                    <label class="flex items-center"><input type="radio" name="education" value="joint" class="mr-2">共同</label>
                                    <label class="flex items-center"><input type="radio" name="education" value="parent1" class="mr-2">親1</label>
                                    <label class="flex items-center"><input type="radio" name="education" value="parent2" class="mr-2">親2</label>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-center">
                                    <span class="font-medium text-gray-700">宗教・文化活動</span>
                                    <label class="flex items-center"><input type="radio" name="religion" value="joint" class="mr-2">共同</label>
                                    <label class="flex items-center"><input type="radio" name="religion" value="parent1" class="mr-2">親1</label>
                                    <label class="flex items-center"><input type="radio" name="religion" value="parent2" class="mr-2">親2</label>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-center">
                                    <span class="font-medium text-gray-700">課外活動</span>
                                    <label class="flex items-center"><input type="radio" name="extracurricular" value="joint" class="mr-2">共同</label>
                                    <label class="flex items-center"><input type="radio" name="extracurricular" value="parent1" class="mr-2">親1</label>
                                    <label class="flex items-center"><input type="radio" name="extracurricular" value="parent2" class="mr-2">親2</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-between mt-8">
                        <button onclick="prevStep()" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg font-medium">
                            <i class="fas fa-arrow-left mr-2"></i>戻る
                        </button>
                        <button onclick="nextStep()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium">
                            次へ <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- ステップ3: スケジュール設定 -->
            <div id="step3" class="wizard-step hidden">
                <div class="bg-white rounded-lg shadow-sm border p-8">
                    <h3 class="text-xl font-semibold text-gray-900 mb-6">面会・滞在スケジュールの設定</h3>
                    
                    <div class="space-y-8">
                        <!-- 基本スケジュールパターン -->
                        <div>
                            <h4 class="text-lg font-medium text-gray-900 mb-4">基本スケジュールパターン</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                <div class="border border-gray-200 rounded-lg p-4 hover:border-blue-500 cursor-pointer schedule-option" onclick="selectSchedule('50-50')">
                                    <h5 class="font-semibold mb-2">50/50 共同監護</h5>
                                    <p class="text-sm text-gray-600 mb-2">週交代または2-2-5-5パターン</p>
                                    <div class="text-xs text-blue-600">推奨: 協力的な関係</div>
                                </div>
                                <div class="border border-gray-200 rounded-lg p-4 hover:border-blue-500 cursor-pointer schedule-option" onclick="selectSchedule('60-40')">
                                    <h5 class="font-semibold mb-2">60/40 分担</h5>
                                    <p class="text-sm text-gray-600 mb-2">平日メイン + 週末</p>
                                    <div class="text-xs text-blue-600">推奨: 学業重視</div>
                                </div>
                                <div class="border border-gray-200 rounded-lg p-4 hover:border-blue-500 cursor-pointer schedule-option" onclick="selectSchedule('80-20')">
                                    <h5 class="font-semibold mb-2">80/20 面会</h5>
                                    <p class="text-sm text-gray-600 mb-2">隔週週末 + 平日1回</p>
                                    <div class="text-xs text-blue-600">推奨: 遠距離・高葛藤</div>
                                </div>
                            </div>
                        </div>

                        <!-- カスタムスケジュール -->
                        <div>
                            <h4 class="text-lg font-medium text-gray-900 mb-4">詳細スケジュール設定</h4>
                            <div class="bg-gray-50 rounded-lg p-6">
                                <div class="grid grid-cols-7 gap-2 mb-4">
                                    <div class="text-center font-medium text-gray-700">月</div>
                                    <div class="text-center font-medium text-gray-700">火</div>
                                    <div class="text-center font-medium text-gray-700">水</div>
                                    <div class="text-center font-medium text-gray-700">木</div>
                                    <div class="text-center font-medium text-gray-700">金</div>
                                    <div class="text-center font-medium text-gray-700">土</div>
                                    <div class="text-center font-medium text-gray-700">日</div>
                                </div>
                                <div class="grid grid-cols-7 gap-2" id="scheduleGrid">
                                    <!-- JavaScript で生成 -->
                                </div>
                            </div>
                        </div>

                        <!-- 祝日・特別な日 -->
                        <div>
                            <h4 class="text-lg font-medium text-gray-900 mb-4">祝日・特別な日の取り決め</h4>
                            <div class="space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-center">
                                    <span class="font-medium text-gray-700">正月（12/31-1/3）</span>
                                    <select class="border border-gray-300 rounded-md px-3 py-2">
                                        <option>交互</option>
                                        <option>親1</option>
                                        <option>親2</option>
                                        <option>分割</option>
                                    </select>
                                    <input type="text" placeholder="詳細・備考" class="border border-gray-300 rounded-md px-3 py-2">
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-center">
                                    <span class="font-medium text-gray-700">ゴールデンウィーク</span>
                                    <select class="border border-gray-300 rounded-md px-3 py-2">
                                        <option>交互</option>
                                        <option>親1</option>
                                        <option>親2</option>
                                        <option>分割</option>
                                    </select>
                                    <input type="text" placeholder="詳細・備考" class="border border-gray-300 rounded-md px-3 py-2">
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-center">
                                    <span class="font-medium text-gray-700">お盆休み</span>
                                    <select class="border border-gray-300 rounded-md px-3 py-2">
                                        <option>交互</option>
                                        <option>親1</option>
                                        <option>親2</option>
                                        <option>分割</option>
                                    </select>
                                    <input type="text" placeholder="詳細・備考" class="border border-gray-300 rounded-md px-3 py-2">
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-center">
                                    <span class="font-medium text-gray-700">誕生日</span>
                                    <select class="border border-gray-300 rounded-md px-3 py-2">
                                        <option>子の誕生日は該当親</option>
                                        <option>交互</option>
                                        <option>分割</option>
                                    </select>
                                    <input type="text" placeholder="詳細・備考" class="border border-gray-300 rounded-md px-3 py-2">
                                </div>
                            </div>
                        </div>

                        <!-- 受け渡し場所・方法 -->
                        <div>
                            <h4 class="text-lg font-medium text-gray-900 mb-4">受け渡し場所・方法</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">平日の受け渡し場所</label>
                                    <select class="w-full border border-gray-300 rounded-md px-3 py-2">
                                        <option>学校・保育園</option>
                                        <option>親1宅</option>
                                        <option>親2宅</option>
                                        <option>中立な場所</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">週末の受け渡し場所</label>
                                    <select class="w-full border border-gray-300 rounded-md px-3 py-2">
                                        <option>各親宅</option>
                                        <option>中立な場所</option>
                                        <option>学校・保育園</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">送迎担当</label>
                                    <select class="w-full border border-gray-300 rounded-md px-3 py-2">
                                        <option>迎えに行く親が送迎</option>
                                        <option>送り出す親が送迎</option>
                                        <option>交互に担当</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">遅刻時の連絡</label>
                                    <select class="w-full border border-gray-300 rounded-md px-3 py-2">
                                        <option>15分前までに連絡</option>
                                        <option>30分前までに連絡</option>
                                        <option>当日連絡</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-between mt-8">
                        <button onclick="prevStep()" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg font-medium">
                            <i class="fas fa-arrow-left mr-2"></i>戻る
                        </button>
                        <button onclick="nextStep()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium">
                            次へ <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- ステップ4: 財務設定 -->
            <div id="step4" class="wizard-step hidden">
                <div class="bg-white rounded-lg shadow-sm border p-8">
                    <h3 class="text-xl font-semibold text-gray-900 mb-6">財務・費用分担の設定</h3>
                    
                    <div class="space-y-8">
                        <!-- 養育費 -->
                        <div>
                            <h4 class="text-lg font-medium text-gray-900 mb-4">養育費</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">月額養育費</label>
                                    <div class="relative">
                                        <span class="absolute left-3 top-2 text-gray-500">¥</span>
                                        <input type="number" class="w-full border border-gray-300 rounded-md pl-8 pr-3 py-2" placeholder="85000">
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">支払日</label>
                                    <select class="w-full border border-gray-300 rounded-md px-3 py-2">
                                        <option>毎月25日</option>
                                        <option>毎月末日</option>
                                        <option>毎月15日</option>
                                        <option>その他</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">支払方法</label>
                                    <select class="w-full border border-gray-300 rounded-md px-3 py-2">
                                        <option>銀行振込</option>
                                        <option>現金手渡し</option>
                                        <option>アプリ決済</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">振込手数料</label>
                                    <select class="w-full border border-gray-300 rounded-md px-3 py-2">
                                        <option>支払者負担</option>
                                        <option>受取者負担</option>
                                        <option>折半</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- 特別費用 -->
                        <div>
                            <h4 class="text-lg font-medium text-gray-900 mb-4">特別費用の分担</h4>
                            <div class="space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-center">
                                    <span class="font-medium text-gray-700">医療費</span>
                                    <select class="border border-gray-300 rounded-md px-3 py-2">
                                        <option>50/50</option>
                                        <option>60/40</option>
                                        <option>70/30</option>
                                        <option>80/20</option>
                                        <option>100/0</option>
                                    </select>
                                    <input type="number" placeholder="上限額" class="border border-gray-300 rounded-md px-3 py-2">
                                    <input type="text" placeholder="備考" class="border border-gray-300 rounded-md px-3 py-2">
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-center">
                                    <span class="font-medium text-gray-700">教育費（塾・習い事）</span>
                                    <select class="border border-gray-300 rounded-md px-3 py-2">
                                        <option>50/50</option>
                                        <option>60/40</option>
                                        <option>70/30</option>
                                        <option>80/20</option>
                                        <option>100/0</option>
                                    </select>
                                    <input type="number" placeholder="上限額" class="border border-gray-300 rounded-md px-3 py-2">
                                    <input type="text" placeholder="事前協議必要" class="border border-gray-300 rounded-md px-3 py-2">
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-center">
                                    <span class="font-medium text-gray-700">課外活動費</span>
                                    <select class="border border-gray-300 rounded-md px-3 py-2">
                                        <option>50/50</option>
                                        <option>60/40</option>
                                        <option>70/30</option>
                                        <option>80/20</option>
                                        <option>100/0</option>
                                    </select>
                                    <input type="number" placeholder="上限額" class="border border-gray-300 rounded-md px-3 py-2">
                                    <input type="text" placeholder="備考" class="border border-gray-300 rounded-md px-3 py-2">
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-center">
                                    <span class="font-medium text-gray-700">緊急医療費</span>
                                    <select class="border border-gray-300 rounded-md px-3 py-2">
                                        <option>50/50</option>
                                        <option>60/40</option>
                                        <option>70/30</option>
                                        <option>80/20</option>
                                        <option>100/0</option>
                                    </select>
                                    <input type="number" placeholder="上限額" class="border border-gray-300 rounded-md px-3 py-2">
                                    <input type="text" placeholder="事後清算可" class="border border-gray-300 rounded-md px-3 py-2">
                                </div>
                            </div>
                        </div>

                        <!-- 保険関連 -->
                        <div>
                            <h4 class="text-lg font-medium text-gray-900 mb-4">保険関連</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">健康保険加入者</label>
                                    <select class="w-full border border-gray-300 rounded-md px-3 py-2">
                                        <option>親1</option>
                                        <option>親2</option>
                                        <option>収入の多い方</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">生命保険受益者</label>
                                    <select class="w-full border border-gray-300 rounded-md px-3 py-2">
                                        <option>子ども</option>
                                        <option>監護親</option>
                                        <option>信託設定</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- 税務関連 -->
                        <div>
                            <h4 class="text-lg font-medium text-gray-900 mb-4">税務関連</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">扶養控除申請者</label>
                                    <select class="w-full border border-gray-300 rounded-md px-3 py-2">
                                        <option>親1</option>
                                        <option>親2</option>
                                        <option>交互</option>
                                        <option>収入に応じて</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">児童手当受給者</label>
                                    <select class="w-full border border-gray-300 rounded-md px-3 py-2">
                                        <option>監護親</option>
                                        <option>収入の多い方</option>
                                        <option>その他</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-between mt-8">
                        <button onclick="prevStep()" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg font-medium">
                            <i class="fas fa-arrow-left mr-2"></i>戻る
                        </button>
                        <button onclick="nextStep()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium">
                            次へ <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- ステップ5: 確認・完了 -->
            <div id="step5" class="wizard-step hidden">
                <div class="bg-white rounded-lg shadow-sm border p-8">
                    <h3 class="text-xl font-semibold text-gray-900 mb-6">プラン内容の確認</h3>
                    
                    <div class="space-y-8">
                        <!-- プラン概要 -->
                        <div class="bg-blue-50 rounded-lg p-6">
                            <h4 class="text-lg font-medium text-blue-900 mb-4">プラン概要</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                <div><span class="font-medium">親権形態:</span> 共同親権</div>
                                <div><span class="font-medium">監護形態:</span> 共同監護</div>
                                <div><span class="font-medium">スケジュール:</span> 50/50 週交代</div>
                                <div><span class="font-medium">月額養育費:</span> ¥85,000</div>
                            </div>
                        </div>

                        <!-- 詳細確認 -->
                        <div class="space-y-6">
                            <div>
                                <h5 class="font-medium text-gray-900 mb-2">基本情報</h5>
                                <div class="bg-gray-50 rounded p-4 text-sm">
                                    <p><strong>親1:</strong> 田中 太郎 (東京都渋谷区)</p>
                                    <p><strong>親2:</strong> 田中 花子 (神奈川県横浜市)</p>
                                    <p><strong>お子様:</strong> 田中 一郎 (2018年4月15日生)</p>
                                </div>
                            </div>

                            <div>
                                <h5 class="font-medium text-gray-900 mb-2">スケジュール詳細</h5>
                                <div class="bg-gray-50 rounded p-4 text-sm">
                                    <p><strong>基本:</strong> 週交代（月曜日18時に交代）</p>
                                    <p><strong>受け渡し:</strong> 学校・保育園</p>
                                    <p><strong>祝日:</strong> 正月・GW・お盆は交互</p>
                                    <p><strong>誕生日:</strong> 子の誕生日は該当親と過ごす</p>
                                </div>
                            </div>

                            <div>
                                <h5 class="font-medium text-gray-900 mb-2">財務取り決め</h5>
                                <div class="bg-gray-50 rounded p-4 text-sm">
                                    <p><strong>養育費:</strong> 月額¥85,000（毎月25日銀行振込）</p>
                                    <p><strong>医療費:</strong> 50/50分担</p>
                                    <p><strong>教育費:</strong> 50/50分担（事前協議必要）</p>
                                    <p><strong>保険:</strong> 親1が健康保険加入</p>
                                </div>
                            </div>
                        </div>

                        <!-- 法的事項 -->
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6">
                            <h4 class="text-lg font-medium text-yellow-800 mb-3">
                                <i class="fas fa-exclamation-triangle mr-2"></i>重要事項
                            </h4>
                            <ul class="text-sm text-yellow-700 space-y-2">
                                <li>• このプランは法的拘束力を持ちます</li>
                                <li>• 変更には両親の合意または裁判所の決定が必要です</li>
                                <li>• 2026年施行予定の改正民法に準拠しています</li>
                                <li>• 専門家の確認を推奨します</li>
                            </ul>
                        </div>

                        <!-- 署名欄 -->
                        <div>
                            <h4 class="text-lg font-medium text-gray-900 mb-4">合意署名</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="border border-gray-300 rounded-lg p-4">
                                    <h5 class="font-medium mb-3">親1の署名</h5>
                                    <div class="space-y-3">
                                        <label class="flex items-center">
                                            <input type="checkbox" class="mr-2">
                                            <span class="text-sm">このプランに同意します</span>
                                        </label>
                                        <input type="text" placeholder="デジタル署名" class="w-full border border-gray-300 rounded px-3 py-2">
                                        <input type="date" class="w-full border border-gray-300 rounded px-3 py-2">
                                    </div>
                                </div>
                                <div class="border border-gray-300 rounded-lg p-4">
                                    <h5 class="font-medium mb-3">親2の署名</h5>
                                    <div class="space-y-3">
                                        <label class="flex items-center">
                                            <input type="checkbox" class="mr-2">
                                            <span class="text-sm">このプランに同意します</span>
                                        </label>
                                        <input type="text" placeholder="デジタル署名（招待待ち）" class="w-full border border-gray-300 rounded px-3 py-2" disabled>
                                        <input type="date" class="w-full border border-gray-300 rounded px-3 py-2" disabled>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-between mt-8">
                        <button onclick="prevStep()" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg font-medium">
                            <i class="fas fa-arrow-left mr-2"></i>戻る
                        </button>
                        <div class="space-x-3">
                            <button onclick="saveDraft()" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg font-medium">
                                <i class="fas fa-save mr-2"></i>下書き保存
                            </button>
                            <button onclick="submitPlan()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-medium">
                                <i class="fas fa-check mr-2"></i>プラン作成完了
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- カレンダー管理 -->
        <div id="calendar" class="section hidden">
            <div class="mb-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-2">カレンダー管理</h2>
                <p class="text-gray-600">面会スケジュールや重要な予定を管理しましょう</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
                <!-- カレンダー表示 -->
                <div class="lg:col-span-3">
                    <div class="bg-white rounded-lg shadow-sm border">
                        <div class="p-6 border-b">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-semibold">2024年1月</h3>
                                <div class="flex items-center space-x-2">
                                    <button class="p-2 hover:bg-gray-100 rounded">
                                        <i class="fas fa-chevron-left"></i>
                                    </button>
                                    <button class="px-4 py-2 bg-blue-600 text-white rounded">今月</button>
                                    <button class="p-2 hover:bg-gray-100 rounded">
                                        <i class="fas fa-chevron-right"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="p-6">
                            <!-- カレンダーグリッド -->
                            <div class="grid grid-cols-7 gap-2 mb-4">
                                <div class="text-center font-medium text-gray-700 p-2">月</div>
                                <div class="text-center font-medium text-gray-700 p-2">火</div>
                                <div class="text-center font-medium text-gray-700 p-2">水</div>
                                <div class="text-center font-medium text-gray-700 p-2">木</div>
                                <div class="text-center font-medium text-gray-700 p-2">金</div>
                                <div class="text-center font-medium text-gray-700 p-2">土</div>
                                <div class="text-center font-medium text-gray-700 p-2">日</div>
                            </div>
                            <div class="grid grid-cols-7 gap-2" id="calendarGrid">
                                <!-- JavaScript で生成 -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- サイドパネル -->
                <div class="space-y-6">
                    <!-- 予定追加 -->
                    <div class="bg-white rounded-lg shadow-sm border p-6">
                        <h4 class="font-semibold mb-4">予定追加</h4>
                        <div class="space-y-4">
                            <input type="date" class="w-full border border-gray-300 rounded px-3 py-2">
                            <input type="text" placeholder="予定のタイトル" class="w-full border border-gray-300 rounded px-3 py-2">
                            <select class="w-full border border-gray-300 rounded px-3 py-2">
                                <option>面会・滞在</option>
                                <option>学校行事</option>
                                <option>医療・健康</option>
                                <option>課外活動</option>
                                <option>その他</option>
                            </select>
                            <textarea placeholder="詳細・備考" class="w-full border border-gray-300 rounded px-3 py-2 h-20"></textarea>
                            <button class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded font-medium">
                                予定を追加
                            </button>
                        </div>
                    </div>

                    <!-- 今日の予定 -->
                    <div class="bg-white rounded-lg shadow-sm border p-6">
                        <h4 class="font-semibold mb-4">今日の予定</h4>
                        <div class="space-y-3">
                            <div class="bg-blue-50 rounded p-3">
                                <div class="flex items-center">
                                    <div class="w-3 h-3 bg-blue-500 rounded-full mr-3"></div>
                                    <div>
                                        <p class="font-medium text-sm">面会開始</p>
                                        <p class="text-xs text-gray-600">18:00 - 学校にお迎え</p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-green-50 rounded p-3">
                                <div class="flex items-center">
                                    <div class="w-3 h-3 bg-green-500 rounded-full mr-3"></div>
                                    <div>
                                        <p class="font-medium text-sm">習字教室</p>
                                        <p class="text-xs text-gray-600">16:00 - 17:00</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- カレンダー凡例 -->
                    <div class="bg-white rounded-lg shadow-sm border p-6">
                        <h4 class="font-semibold mb-4">凡例</h4>
                        <div class="space-y-2 text-sm">
                            <div class="flex items-center">
                                <div class="w-4 h-4 bg-blue-500 rounded mr-3"></div>
                                <span>親1との時間</span>
                            </div>
                            <div class="flex items-center">
                                <div class="w-4 h-4 bg-green-500 rounded mr-3"></div>
                                <span>親2との時間</span>
                            </div>
                            <div class="flex items-center">
                                <div class="w-4 h-4 bg-purple-500 rounded mr-3"></div>
                                <span>学校行事</span>
                            </div>
                            <div class="flex items-center">
                                <div class="w-4 h-4 bg-orange-500 rounded mr-3"></div>
                                <span>課外活動</span>
                            </div>
                            <div class="flex items-center">
                                <div class="w-4 h-4 bg-red-500 rounded mr-3"></div>
                                <span>医療・健康</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- コミュニケーション -->
        <div id="communication" class="section hidden">
            <div class="mb-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-2">コミュニケーション</h2>
                <p class="text-gray-600">安全で記録に残るコミュニケーションツール</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
                <!-- メッセージ表示 -->
                <div class="lg:col-span-3">
                    <div class="bg-white rounded-lg shadow-sm border h-96 flex flex-col">
                        <div class="p-6 border-b">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center mr-3">
                                        <span class="text-white font-medium">花</span>
                                    </div>
                                    <div>
                                        <h3 class="font-semibold">田中 花子</h3>
                                        <p class="text-sm text-green-600">オンライン</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <button class="p-2 hover:bg-gray-100 rounded">
                                        <i class="fas fa-phone text-blue-600"></i>
                                    </button>
                                    <button class="p-2 hover:bg-gray-100 rounded">
                                        <i class="fas fa-video text-blue-600"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- メッセージリスト -->
                        <div class="flex-1 p-6 overflow-y-auto" id="messageList">
                            <div class="space-y-4">
                                <div class="message-bubble">
                                    <div class="flex items-start">
                                        <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center mr-3">
                                            <span class="text-white text-sm">花</span>
                                        </div>
                                        <div>
                                            <div class="bg-gray-100 rounded-lg px-4 py-2 max-w-md">
                                                <p class="text-sm">明日の習字教室のお迎えの件でご相談があります。</p>
                                            </div>
                                            <p class="text-xs text-gray-500 mt-1">2時間前</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="message-bubble flex justify-end">
                                    <div class="flex items-start flex-row-reverse">
                                        <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center ml-3">
                                            <span class="text-white text-sm">太</span>
                                        </div>
                                        <div>
                                            <div class="bg-blue-500 text-white rounded-lg px-4 py-2 max-w-md">
                                                <p class="text-sm">はい、どのような件でしょうか？</p>
                                            </div>
                                            <p class="text-xs text-gray-500 mt-1 text-right">1時間前</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="message-bubble">
                                    <div class="flex items-start">
                                        <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center mr-3">
                                            <span class="text-white text-sm">花</span>
                                        </div>
                                        <div>
                                            <div class="bg-gray-100 rounded-lg px-4 py-2 max-w-md">
                                                <p class="text-sm">仕事の都合で17:30頃になりそうです。お迎えをお願いできますでしょうか？</p>
                                            </div>
                                            <p class="text-xs text-gray-500 mt-1">30分前</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- メッセージ入力 -->
                        <div class="p-6 border-t">
                            <div class="flex items-center space-x-3">
                                <button class="p-2 hover:bg-gray-100 rounded">
                                    <i class="fas fa-paperclip text-gray-500"></i>
                                </button>
                                <div class="flex-1 relative">
                                    <input type="text" id="messageInput" placeholder="メッセージを入力..." class="w-full border border-gray-300 rounded-full px-4 py-2 pr-10">
                                    <div class="absolute right-3 top-2">
                                        <span class="text-xs text-green-600" id="toneIndicator">適切</span>
                                    </div>
                                </div>
                                <button onclick="sendMessage()" class="bg-blue-600 hover:bg-blue-700 text-white p-2 rounded-full">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                            <p class="text-xs text-gray-500 mt-2">
                                <i class="fas fa-shield-alt text-green-600 mr-1"></i>
                                メッセージは暗号化され、法的記録として保存されます
                            </p>
                        </div>
                    </div>
                </div>

                <!-- サイドパネル -->
                <div class="space-y-6">
                    <!-- AI感情分析 -->
                    <div class="bg-white rounded-lg shadow-sm border p-6">
                        <h4 class="font-semibold mb-4">コミュニケーション分析</h4>
                        <div class="space-y-3">
                            <div>
                                <div class="flex justify-between items-center mb-1">
                                    <span class="text-sm">感情的な表現</span>
                                    <span class="text-sm text-green-600">低</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="bg-green-500 h-2 rounded-full" style="width: 20%"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between items-center mb-1">
                                    <span class="text-sm">建設的な内容</span>
                                    <span class="text-sm text-green-600">高</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="bg-green-500 h-2 rounded-full" style="width: 85%"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between items-center mb-1">
                                    <span class="text-sm">協力的な姿勢</span>
                                    <span class="text-sm text-green-600">高</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="bg-green-500 h-2 rounded-full" style="width: 90%"></div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-green-50 rounded">
                            <p class="text-sm text-green-700">
                                <i class="fas fa-check-circle mr-2"></i>
                                良好なコミュニケーションが維持されています
                            </p>
                        </div>
                    </div>

                    <!-- クイックリプライ -->
                    <div class="bg-white rounded-lg shadow-sm border p-6">
                        <h4 class="font-semibold mb-4">クイックリプライ</h4>
                        <div class="space-y-2">
                            <button onclick="addQuickReply('承知いたしました。')" class="w-full text-left p-2 hover:bg-gray-100 rounded text-sm">
                                承知いたしました。
                            </button>
                            <button onclick="addQuickReply('ありがとうございます。')" class="w-full text-left p-2 hover:bg-gray-100 rounded text-sm">
                                ありがとうございます。
                            </button>
                            <button onclick="addQuickReply('確認させていただきます。')" class="w-full text-left p-2 hover:bg-gray-100 rounded text-sm">
                                確認させていただきます。
                            </button>
                            <button onclick="addQuickReply('調整いたします。')" class="w-full text-left p-2 hover:bg-gray-100 rounded text-sm">
                                调整いたします。
                            </button>
                        </div>
                    </div>

                    <!-- 緊急連絡 -->
                    <div class="bg-white rounded-lg shadow-sm border p-6">
                        <h4 class="font-semibold mb-4">緊急連絡</h4>
                        <div class="space-y-3">
                            <button class="w-full bg-red-600 hover:bg-red-700 text-white py-2 rounded font-medium">
                                <i class="fas fa-phone mr-2"></i>緊急通話
                            </button>
                            <button class="w-full bg-orange-600 hover:bg-orange-700 text-white py-2 rounded font-medium">
                                <i class="fas fa-exclamation-triangle mr-2"></i>緊急メッセージ
                            </button>
                        </div>
                        <p class="text-xs text-gray-500 mt-3">
                            緊急時はすべての通知制限を無視して即座に相手に届きます
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 費用管理 -->
        <div id="expenses" class="section hidden">
            <div class="mb-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-2">費用管理</h2>
                <p class="text-gray-600">養育費や特別費用の管理・精算を行いましょう</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- 費用概要 -->
                <div class="lg:col-span-2 space-y-6">
                    <!-- 今月の概要 -->
                    <div class="bg-white rounded-lg shadow-sm border p-6">
                        <h3 class="text-lg font-semibold mb-4">今月の費用概要</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            <div class="text-center">
                                <div class="text-2xl font-bold text-blue-600">¥85,000</div>
                                <div class="text-sm text-gray-600">養育費（支払済）</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-orange-600">¥12,500</div>
                                <div class="text-sm text-gray-600">特別費用</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-green-600">¥6,250</div>
                                <div class="text-sm text-gray-600">自己負担分</div>
                            </div>
                        </div>
                        <canvas id="expenseChart" style="height: 300px;"></canvas>
                    </div>

                    <!-- 費用履歴 -->
                    <div class="bg-white rounded-lg shadow-sm border">
                        <div class="p-6 border-b">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-semibold">費用履歴</h3>
                                <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded font-medium">
                                    <i class="fas fa-plus mr-2"></i>費用追加
                                </button>
                            </div>
                        </div>
                        <div class="divide-y">
                            <div class="p-6">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-4">
                                            <i class="fas fa-yen-sign text-blue-600"></i>
                                        </div>
                                        <div>
                                            <p class="font-medium">月額養育費</p>
                                            <p class="text-sm text-gray-600">2024年1月分</p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-semibold">¥85,000</p>
                                        <p class="text-sm text-green-600">支払済</p>
                                    </div>
                                </div>
                            </div>
                            <div class="p-6">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <div class="w-10 h-10 bg-red-100 rounded-full flex items-center justify-center mr-4">
                                            <i class="fas fa-user-md text-red-600"></i>
                                        </div>
                                        <div>
                                            <p class="font-medium">小児科受診</p>
                                            <p class="text-sm text-gray-600">2024年1月15日</p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-semibold">¥3,500</p>
                                        <p class="text-sm text-orange-600">精算待ち</p>
                                    </div>
                                </div>
                            </div>
                            <div class="p-6">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <div class="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center mr-4">
                                            <i class="fas fa-music text-purple-600"></i>
                                        </div>
                                        <div>
                                            <p class="font-medium">ピアノレッスン</p>
                                            <p class="text-sm text-gray-600">2024年1月分</p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-semibold">¥9,000</p>
                                        <p class="text-sm text-green-600">精算済</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- サイドパネル -->
                <div class="space-y-6">
                    <!-- 費用追加フォーム -->
                    <div class="bg-white rounded-lg shadow-sm border p-6">
                        <h4 class="font-semibold mb-4">費用を追加</h4>
                        <div class="space-y-4">
                            <select class="w-full border border-gray-300 rounded px-3 py-2">
                                <option>医療費</option>
                                <option>教育費</option>
                                <option>課外活動費</option>
                                <option>緊急費用</option>
                                <option>その他</option>
                            </select>
                            <input type="text" placeholder="項目名" class="w-full border border-gray-300 rounded px-3 py-2">
                            <input type="number" placeholder="金額" class="w-full border border-gray-300 rounded px-3 py-2">
                            <input type="date" class="w-full border border-gray-300 rounded px-3 py-2">
                            <textarea placeholder="詳細・備考" class="w-full border border-gray-300 rounded px-3 py-2 h-20"></textarea>
                            <div class="flex items-center">
                                <input type="file" id="receiptFile" class="hidden">
                                <button onclick="document.getElementById('receiptFile').click()" class="flex items-center text-blue-600 text-sm">
                                    <i class="fas fa-paperclip mr-2"></i>領収書を添付
                                </button>
                            </div>
                            <button class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded font-medium">
                                費用を追加
                            </button>
                        </div>
                    </div>

                    <!-- 精算待ち -->
                    <div class="bg-white rounded-lg shadow-sm border p-6">
                        <h4 class="font-semibold mb-4">精算待ち項目</h4>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between p-3 bg-orange-50 rounded">
                                <div class="text-sm">
                                    <p class="font-medium">小児科受診</p>
                                    <p class="text-gray-600">自己負担: ¥1,750</p>
                                </div>
                                <button class="text-xs bg-orange-600 text-white px-2 py-1 rounded">
                                    請求
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 支払い方法 -->
                    <div class="bg-white rounded-lg shadow-sm border p-6">
                        <h4 class="font-semibold mb-4">支払い・送金</h4>
                        <div class="space-y-3">
                            <button class="w-full bg-green-600 hover:bg-green-700 text-white py-2 rounded font-medium">
                                <i class="fas fa-credit-card mr-2"></i>カード決済
                            </button>
                            <button class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded font-medium">
                                <i class="fas fa-university mr-2"></i>銀行振込
                            </button>
                            <button class="w-full bg-purple-600 hover:bg-purple-700 text-white py-2 rounded font-medium">
                                <i class="fas fa-mobile-alt mr-2"></i>アプリ決済
                            </button>
                        </div>
                    </div>

                    <!-- 自動支払い設定 -->
                    <div class="bg-white rounded-lg shadow-sm border p-6">
                        <h4 class="font-semibold mb-4">自動支払い設定</h4>
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2" checked>
                                <span class="text-sm">養育費自動支払い</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2">
                                <span class="text-sm">定期習い事費</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2">
                                <span class="text-sm">保険料自動分担</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // グローバル変数
        let currentStep = 1;
        let currentSection = 'dashboard';

        // セクション切り替え
        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(sectionName).classList.remove('hidden');
            currentSection = sectionName;

            // セクション別の初期化
            if (sectionName === 'calendar') {
                initializeCalendar();
            } else if (sectionName === 'dashboard') {
                initializeCharts();
            } else if (sectionName === 'expenses') {
                initializeExpenseChart();
            }
        }

        // ウィザードのステップ管理
        function nextStep() {
            if (currentStep < 5) {
                document.getElementById('step' + currentStep).classList.add('hidden');
                currentStep++;
                document.getElementById('step' + currentStep).classList.remove('hidden');
                updateProgress();
                updateStepIndicator();
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                document.getElementById('step' + currentStep).classList.add('hidden');
                currentStep--;
                document.getElementById('step' + currentStep).classList.remove('hidden');
                updateProgress();
                updateStepIndicator();
            }
        }

        function updateProgress() {
            const progress = (currentStep / 5) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
        }

        function updateStepIndicator() {
            document.querySelectorAll('.step-circle').forEach((circle, index) => {
                circle.classList.remove('step-active', 'step-completed');
                if (index + 1 < currentStep) {
                    circle.classList.add('step-completed');
                } else if (index + 1 === currentStep) {
                    circle.classList.add('step-active');
                }
            });
        }

        // 子供追加機能
        function addChild() {
            const childrenList = document.getElementById('childrenList');
            const newChild = document.createElement('div');
            newChild.className = 'border border-gray-200 rounded-lg p-4 mb-4';
            newChild.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">氏名</label>
                        <input type="text" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500" placeholder="お子様の氏名">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">生年月日</label>
                        <input type="date" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">現在の主な居住地</label>
                        <select class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500">
                            <option>親1宅</option>
                            <option>親2宅</option>
                        </select>
                    </div>
                </div>
                <button onclick="this.parentElement.remove()" class="text-red-600 text-sm mt-2">
                    <i class="fas fa-trash mr-1"></i>削除
                </button>
            `;
            childrenList.appendChild(newChild);
        }

        // スケジュール選択
        function selectSchedule(type) {
            document.querySelectorAll('.schedule-option').forEach(option => {
                option.classList.remove('border-blue-500', 'bg-blue-50');
            });
            event.target.closest('.schedule-option').classList.add('border-blue-500', 'bg-blue-50');
        }

        // カレンダー初期化
        function initializeCalendar() {
            const calendarGrid = document.getElementById('calendarGrid');
            if (!calendarGrid) return;

            calendarGrid.innerHTML = '';
            
            // 2024年1月のカレンダーを生成
            const daysInMonth = 31;
            const firstDayOfWeek = 0; // 月曜日 = 1, 日曜日 = 0
            
            // 空白セルを追加
            for (let i = 0; i < firstDayOfWeek; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'p-2';
                calendarGrid.appendChild(emptyCell);
            }
            
            // 日付セルを追加
            for (let day = 1; day <= daysInMonth; day++) {
                const dayCell = document.createElement('div');
                dayCell.className = 'calendar-day p-2 text-center border rounded cursor-pointer';
                dayCell.textContent = day;
                
                // サンプルイベントを追加
                if (day % 7 === 1 || day % 7 === 2) {
                    dayCell.classList.add('bg-blue-100');
                    const event = document.createElement('div');
                    event.className = 'text-xs text-blue-600 mt-1';
                    event.textContent = '親1';
                    dayCell.appendChild(event);
                } else if (day % 7 === 3 || day % 7 === 4) {
                    dayCell.classList.add('bg-green-100');
                    const event = document.createElement('div');
                    event.className = 'text-xs text-green-600 mt-1';
                    event.textContent = '親2';
                    dayCell.appendChild(event);
                }
                
                dayCell.addEventListener('click', () => {
                    document.querySelectorAll('.calendar-selected').forEach(cell => {
                        cell.classList.remove('calendar-selected');
                    });
                    dayCell.classList.add('calendar-selected');
                });
                
                calendarGrid.appendChild(dayCell);
            }
        }

        // チャート初期化
        function initializeCharts() {
            const ctx = document.getElementById('parentingTimeChart');
            if (!ctx) return;

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['親1との時間', '親2との時間', '学校・保育園'],
                    datasets: [{
                        data: [40, 35, 25],
                        backgroundColor: ['#3b82f6', '#10b981', '#f59e0b']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // 費用チャート初期化
        function initializeExpenseChart() {
            const ctx = document.getElementById('expenseChart');
            if (!ctx) return;

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['養育費', '医療費', '教育費', '課外活動', 'その他'],
                    datasets: [{
                        label: '支出額',
                        data: [85000, 3500, 9000, 5000, 2000],
                        backgroundColor: ['#3b82f6', '#ef4444', '#8b5cf6', '#f59e0b', '#6b7280']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '¥' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }

        // メッセージ送信
        function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const messageList = document.getElementById('messageList');
            const message = messageInput.value.trim();
            
            if (message) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message-bubble flex justify-end';
                messageDiv.innerHTML = `
                    <div class="flex items-start flex-row-reverse">
                        <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center ml-3">
                            <span class="text-white text-sm">太</span>
                        </div>
                        <div>
                            <div class="bg-blue-500 text-white rounded-lg px-4 py-2 max-w-md">
                                <p class="text-sm">${message}</p>
                            </div>
                            <p class="text-xs text-gray-500 mt-1 text-right">今</p>
                        </div>
                    </div>
                `;
                messageList.appendChild(messageDiv);
                messageInput.value = '';
                messageList.scrollTop = messageList.scrollHeight;
            }
        }

        // クイックリプライ追加
        function addQuickReply(text) {
            document.getElementById('messageInput').value = text;
        }

        // Enter キーでメッセージ送信
        document.addEventListener('DOMContentLoaded', function() {
            const messageInput = document.getElementById('messageInput');
            if (messageInput) {
                messageInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendMessage();
                    }
                });

                // トーン検知シミュレーション
                messageInput.addEventListener('input', function() {
                    const toneIndicator = document.getElementById('toneIndicator');
                    const text = this.value.toLowerCase();
                    
                    if (text.includes('だめ') || text.includes('いやだ') || text.includes('無理')) {
                        toneIndicator.textContent = '注意';
                        toneIndicator.className = 'text-xs text-red-600';
                    } else if (text.includes('お願い') || text.includes('ありがとう') || text.includes('協力')) {
                        toneIndicator.textContent = '良好';
                        toneIndicator.className = 'text-xs text-green-600';
                    } else {
                        toneIndicator.textContent = '適切';
                        toneIndicator.className = 'text-xs text-green-600';
                    }
                });
            }
        });

        // ステップ円の生成
        document.addEventListener('DOMContentLoaded', function() {
            const stepContainer = document.querySelector('.flex.items-center.justify-between.mb-4');
            if (stepContainer) {
                // 既存のstep-circleクラスにスタイルを追加
                const style = document.createElement('style');
                style.textContent = `
                    .step-circle {
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        justify-content: center;
                        width: 80px;
                        height: 80px;
                        border-radius: 50%;
                        border: 2px solid #e5e7eb;
                        background: white;
                        color: #6b7280;
                        font-size: 12px;
                        text-align: center;
                        transition: all 0.3s;
                        cursor: pointer;
                    }
                    .step-circle i {
                        font-size: 18px;
                        margin-bottom: 4px;
                    }
                `;
                document.head.appendChild(style);
            }

            // 初期表示
            showSection('dashboard');
        });

        // プラン完了処理
        function submitPlan() {
            alert('ペアレンティングプランが正常に作成されました。\n相手方に署名依頼を送信します。');
            showSection('dashboard');
        }

        function saveDraft() {
            alert('下書きとして保存されました。');
        }
    </script>
</body>
</html>